{"version":3,"sources":["../src/question_slot.js"],"names":["SELECTORS","setSelectors","slotId","slotIdClass","VERSION_LIST","SLOT_ID","QUESTION_NAME","QUESTION_TEXT","ajax","request","Ajax","call","done","response","result","document","querySelector","innerHTML","name","questiontext","previewtag","tempo","createElement","replaceWith","firstChild","editurl","href","URL","searchparams","searchParams","set","questionid","search","toString","fail","Notification","exception","changeVersion","selectElement","addEventListener","versionSelected","parseInt","value","previewurl","methodname","args","slotid","newversion","init"],"mappings":"yKAwBA,OACA,O,sDAQIA,CAAAA,CAAS,CAAG,E,CAQVC,CAAY,CAAG,SAACC,CAAD,CAAY,CAC7B,GAAIC,CAAAA,CAAW,CAAG,EAAlB,CACA,GAAID,CAAJ,CAAY,CACRC,CAAW,CAAG,IAAMD,CACvB,CAEDF,CAAS,CAAG,CACRI,YAAY,CAAE,WAAaD,CADnB,CAERE,OAAO,CAAE,yBAA2BF,CAF5B,CAGRG,aAAa,CAAE,gBAAkBH,CAHzB,CAIRI,aAAa,CAAE,gBAAkBJ,CAJzB,CAMf,C,CAQKK,CAAI,CAAG,SAACC,CAAD,CAAa,CACtB,MAAOC,WAAKC,IAAL,CAAUF,CAAV,EAAmB,CAAnB,EAAsBG,IAAtB,CAA2B,SAACC,CAAD,CAAc,CAC5C,GAAI,KAAAA,CAAQ,CAACC,MAAb,CAA8B,CAC1BC,QAAQ,CAACC,aAAT,CAAuBhB,CAAS,CAACM,aAAjC,EAAgDW,SAAhD,CAA4DJ,CAAQ,CAACK,IAArE,CACAH,QAAQ,CAACC,aAAT,CAAuBhB,CAAS,CAACO,aAAjC,EAAgDU,SAAhD,CAA4DJ,CAAQ,CAACM,YAArE,CAF0B,GAGtBC,CAAAA,CAAU,CAAGL,QAAQ,CAACC,aAAT,CAAuBhB,CAAS,CAACK,OAAV,CAAoB,wBAA3C,CAHS,CAItBgB,CAAK,CAAGN,QAAQ,CAACO,aAAT,CAAuB,KAAvB,CAJc,CAK1BD,CAAK,CAACJ,SAAN,CAAkBJ,CAAQ,CAACO,UAA3B,CACAA,CAAU,CAACG,WAAX,CAAuBF,CAAK,CAACG,UAA7B,EACA,GAAIC,CAAAA,CAAO,CAAGV,QAAQ,CAACC,aAAT,CAAuBhB,CAAS,CAACK,OAAV,CAAoB,0BAA3C,EAAuEqB,IAArF,CACAD,CAAO,CAAG,GAAIE,CAAAA,GAAJ,CAAQF,CAAR,CAAV,CACA,GAAIG,CAAAA,CAAY,CAAGH,CAAO,CAACI,YAA3B,CACAD,CAAY,CAACE,GAAb,CAAiB,IAAjB,CAAuBjB,CAAQ,CAACkB,UAAhC,EACAN,CAAO,CAACO,MAAR,CAAiBJ,CAAY,CAACK,QAAb,EAAjB,CACAR,CAAO,CAAGA,CAAO,CAACQ,QAAR,EAAV,CACAlB,QAAQ,CAACC,aAAT,CAAuBhB,CAAS,CAACK,OAAV,CAAoB,0BAA3C,EAAuEqB,IAAvE,CAA8ED,CAUjF,CACJ,CAzBM,EAyBJS,IAzBI,CAyBCC,UAAaC,SAzBd,CA0BV,C,CAOKC,CAAa,CAAG,SAACnC,CAAD,CAAY,CAC9B,GAAMoC,CAAAA,CAAa,CAAGvB,QAAQ,CAACC,aAAT,CAAuBhB,CAAS,CAACI,YAAjC,CAAtB,CACAkC,CAAa,CAACC,gBAAd,CAA+B,QAA/B,CAAyC,UAAM,IACvCC,CAAAA,CAAe,CAAGC,QAAQ,CAACH,CAAa,CAACI,KAAf,CADa,CAEvCC,CAAU,CAAG5B,QAAQ,CAACC,aAAT,CAAuBhB,CAAS,CAACK,OAAV,CAAoB,wBAA3C,EAAqEqB,IAF3C,CAG3CzB,CAAY,CAACC,CAAD,CAAZ,CASAM,CAAI,CARU,CAAC,CACXoC,UAAU,CAAE,+BADD,CAEXC,IAAI,CAAE,CACFC,MAAM,CAAE5C,CADN,CAEF6C,UAAU,CAAEP,CAFV,CAGFG,UAAU,CAAEA,CAHV,CAFK,CAAD,CAQV,CACP,CAbD,CAcH,C,QAOmB,QAAPK,CAAAA,IAAO,CAAC9C,CAAD,CAAY,CAC5BD,CAAY,CAACC,CAAD,CAAZ,CACAmC,CAAa,CAACnC,CAAD,CAChB,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Render the question slot template for each question in the quiz edit view.\n *\n * @module     mod_quiz/question_slot\n * @copyright  2021 Catalyst IT Australia Pty Ltd\n * @author     Guillermo Gomez Arias <guillermogomez@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\n\n/**\n *\n * Initialize CSS selectors.\n *\n * @type {object}\n */\nlet SELECTORS = {};\n\n/**\n * Set CSS selector.\n * Add slot id to class if is not null.\n *\n * @param {int} slotId The slot id.\n */\nconst setSelectors = (slotId) => {\n    let slotIdClass = '';\n    if (slotId) {\n        slotIdClass = '-' + slotId;\n    }\n\n    SELECTORS = {\n        VERSION_LIST: '#version' + slotIdClass,\n        SLOT_ID: '#mod-indent-outer-slot' + slotIdClass,\n        QUESTION_NAME: '#questionname' + slotIdClass,\n        QUESTION_TEXT: '#questiontext' + slotIdClass,\n    };\n};\n\n/**\n * Helper ajax function.\n *\n * @param {object} request The request to be made.\n * @returns {Promise}\n */\nconst ajax = (request) => {\n    return Ajax.call(request)[0].done((response) => {\n        if (response.result === true) {\n            document.querySelector(SELECTORS.QUESTION_NAME).innerHTML = response.name;\n            document.querySelector(SELECTORS.QUESTION_TEXT).innerHTML = response.questiontext;\n            let previewtag = document.querySelector(SELECTORS.SLOT_ID + ' > .actions > .preview');\n            let tempo = document.createElement('div');\n            tempo.innerHTML = response.previewtag;\n            previewtag.replaceWith(tempo.firstChild);\n            let editurl = document.querySelector(SELECTORS.SLOT_ID + ' > .activityinstance > a').href;\n            editurl = new URL(editurl);\n            let searchparams = editurl.searchParams;\n            searchparams.set('id', response.questionid);\n            editurl.search = searchparams.toString();\n            editurl = editurl.toString();\n            document.querySelector(SELECTORS.SLOT_ID + ' > .activityinstance > a').href = editurl;\n            // let previewurl = document.querySelector(SELECTORS.SLOT_ID + ' > .actions > .preview');\n            // console.log(previewurl);\n            // let previewurl = document.querySelector(SELECTORS.SLOT_ID + ' > .actions > .preview').href;\n            // previewurl = new URL(previewurl);\n            // let searchPreviewParam = previewurl.searchParams;\n            // searchPreviewParam.set('id', response.questionid);\n            // previewurl.search = searchPreviewParam.toString();\n            // previewurl = previewurl.toString();\n            // document.querySelector(SELECTORS.SLOT_ID + ' > .actions > .preview').href = previewurl;\n        }\n    }).fail(Notification.exception);\n};\n\n/**\n * Replace the container with a new version.\n *\n * @param {int} slotId\n */\nconst changeVersion = (slotId) => {\n    const selectElement = document.querySelector(SELECTORS.VERSION_LIST);\n    selectElement.addEventListener('change', () => {\n        let versionSelected = parseInt(selectElement.value);\n        let previewurl = document.querySelector(SELECTORS.SLOT_ID + ' > .actions > .preview').href;\n        setSelectors(slotId);\n        let request = [{\n            methodname: 'mod_quiz_set_question_version',\n            args: {\n                slotid: slotId,\n                newversion: versionSelected,\n                previewurl: previewurl,\n            }\n        }];\n        ajax(request);\n    });\n};\n\n/**\n * Entrypoint of the js.\n *\n * @param {int} slotId\n */\nexport const init = (slotId) => {\n    setSelectors(slotId);\n    changeVersion(slotId);\n};\n"],"file":"question_slot.min.js"}