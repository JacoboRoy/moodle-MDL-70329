{"version":3,"sources":["../src/filter.js"],"names":["init","filterRegionId","defaultcourseid","defaultcategoryid","perpage","courseid","categories","qtagids","qbshowtext","recurse","showhidden","TEMPLATE_NAME","CoreFilter","filterdata","pendingPromise","applyFilter","requestQuestions","qperpage","qpage","ajax","call","methodname","args","category","values","toString","then","response","totalquestions","firstpagehtml","html","renderPagination","js","questionscontainer","document","getElementById","Templates","replaceNodeContents","resolve","fail","Notification","exception","PagedContentFactory","createFromAjax","pagesData","map","pageData","pageNumber","render"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Question bank filter managemnet.\n *\n * @module     qbank_editquestion/filter\n * @copyright  2021 Tomo Tsuyuki <tomotsuyuki@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as CoreFilter from 'core/filter';\nimport ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport PagedContentFactory from 'core/paged_content_factory';\n\n/**\n * Initialise the question bank filter on the element with the given id.\n *\n * @param {String} filterRegionId\n * @param {String} defaultcourseid\n * @param {String} defaultcategoryid\n * @param {int} perpage\n */\nexport const init = (filterRegionId, defaultcourseid, defaultcategoryid, perpage) => {\n    var courseid;\n    var categories;\n    var qtagids;\n    var qbshowtext = false;\n    var recurse = 0;\n    var showhidden = false;\n\n    var TEMPLATE_NAME = 'qbank_editquestion/qbank_questions';\n\n    CoreFilter.init(filterRegionId, 'QbankTable', function(filterdata, pendingPromise) {\n        applyFilter(filterdata, pendingPromise);\n    });\n\n    /**\n     * Ajax call to retrieve question via ws functions\n     *\n     * @param {String} courseid course id\n     * @param {String} categories sequence of categories\n     * @param {String} qtagids sequence of tags\n     * @param {int} qperpage number of questions perpage\n     * @param {int} qpage current page\n     * @param {int} qbshowtext\n     * @param {int} recurse\n     * @param {int} showhidden\n     * @returns {*}\n     */\n    var requestQuestions = function(courseid, categories, qtagids, qperpage, qpage, qbshowtext, recurse, showhidden) {\n        var request = {\n            methodname: 'core_qbank_dummy',\n            args: {\n                courseid: courseid,\n                category: categories,\n                qtagids: qtagids,\n                qperpage: qperpage,\n                qpage: qpage,\n                qbshowtext: qbshowtext,\n                recurse: recurse,\n                showhidden: showhidden\n            }\n        };\n\n        return ajax.call([request])[0];\n    };\n\n    /**\n     * Retrieve table data.\n     *\n     * @param {Object} filter data\n     * @param {Promise} filter pending promise\n     */\n    const applyFilter = (filterdata, pendingPromise) => {\n        if (filterdata) {\n            courseid = filterdata['courseid'].values.toString();\n            categories = filterdata['category'] ? filterdata['category'].values.toString() : '';\n            qtagids = filterdata['tag'] ? filterdata['tag'].values.toString() : '';\n        } else {\n            courseid = defaultcourseid;\n            categories = defaultcategoryid;\n            qtagids = '';\n        }\n\n        // Load first page.\n        var qpage = 0;\n\n        requestQuestions(courseid, categories, qtagids, perpage, qpage, qbshowtext, recurse, showhidden)\n            .then(function(response) {\n                let totalquestions = response.totalquestions;\n                let firstpagehtml = response.html;\n                return renderPagination(perpage, totalquestions, firstpagehtml);\n            })\n            .then(function(html, js) {\n                let questionscontainer = document.getElementById('questionscontainer');\n                Templates.replaceNodeContents(questionscontainer, html, js);\n                if (pendingPromise) {\n                    pendingPromise.resolve();\n                }\n                return;\n            })\n            .fail(Notification.exception);\n    };\n\n    /**\n     * Render table and pagination.\n     *\n     * @param {int} perpage\n     * @param {int} totalquestions\n     * @param {string} firstpagehtml\n     */\n    const renderPagination = (perpage, totalquestions, firstpagehtml) => {\n        return PagedContentFactory.createFromAjax(\n            totalquestions,\n            perpage,\n            function(pagesData) {\n                return pagesData.map(function(pageData) {\n                    let pageNumber = pageData.pageNumber;\n                    // Page number start at 1.\n                    let qpage = pageNumber - 1;\n\n                    // Render first page\n                    if (qpage == 0) {\n                        return Templates.render(TEMPLATE_NAME, {html: firstpagehtml});\n                    } else {\n                        // Load data for selected page.\n                        return requestQuestions(courseid, categories, qtagids, perpage, qpage, qbshowtext, recurse, showhidden)\n                        .then(function(response) {\n                            return Templates.render(TEMPLATE_NAME, {html: response.html});\n                        })\n                        .fail(Notification.exception);\n                    }\n                });\n            }\n        );\n    };\n\n    // Run apply filter at page load.\n    applyFilter();\n};\n\n"],"file":"filter.min.js"}