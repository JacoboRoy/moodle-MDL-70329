{"version":3,"sources":["../src/filter.js"],"names":["init","filterRegionId","defaultcourseid","defaultcategoryid","perpage","CoreFilter","filterdata","pendingPromise","applyFilter","courseid","values","toString","categories","qtagids","qperpage","qpage","promises","ajax","call","methodname","args","category","qbshowtext","recurse","showhidden","done","response","questionscontainer","document","getElementById","totalpage","pagination","renderPagination","html","resolve","page","container","PagedContentFactory","createWithLimit","pagesData","actions","map","pageData","allItemsLoaded","console","log","controlPlacementBottom","eventNamespace","persistentLimitKey","then","js","Templates","replaceNodeContents"],"mappings":"sgBAuBA,OACA,OACA,OACA,OACA,O,ylBAUO,GAAMA,CAAAA,CAAI,CAAG,SAACC,CAAD,CAAiBC,CAAjB,CAAkCC,CAAlC,CAAqDC,CAArD,CAAiE,CACjFC,CAAU,CAACL,IAAX,CAAgBC,CAAhB,CAAgC,YAAhC,CAA8C,SAASK,CAAT,CAAqBC,CAArB,CAAqC,CAC/EC,CAAW,CAACF,CAAD,CAAaC,CAAb,CACd,CAFD,EADiF,GAW3EC,CAAAA,CAAW,CAAG,SAACF,CAAD,CAAaC,CAAb,CAAgC,CAChD,GAAID,CAAJ,CAAgB,IACRG,CAAAA,CAAQ,CAAGH,CAAU,SAAV,CAAuBI,MAAvB,CAA8BC,QAA9B,EADH,CAERC,CAAU,CAAGN,CAAU,SAAV,CAAyBA,CAAU,SAAV,CAAuBI,MAAvB,CAA8BC,QAA9B,EAAzB,CAAoE,EAFzE,CAGRE,CAAO,CAAGP,CAAU,IAAV,CAAoBA,CAAU,IAAV,CAAkBI,MAAlB,CAAyBC,QAAzB,EAApB,CAA0D,EAC3E,CAJD,IAIO,IACCF,CAAAA,CAAQ,CAAGP,CADZ,CAECU,CAAU,CAAGT,CAFd,CAGCU,CAAO,CAAG,EACjB,CAT+C,GAW5CC,CAAAA,CAAQ,CAAGV,CAXiC,CAY5CW,CAAK,CAAG,CAZoC,CAiB5CC,CAAQ,CAAGC,UAAKC,IAAL,CAAU,CAAC,CACtBC,UAAU,CAAE,kBADU,CACUC,IAAI,CAAE,CAC9BX,QAAQ,CAAEA,CADoB,CAE9BY,QAAQ,CAAET,CAFoB,CAG7BC,OAAO,CAAEA,CAHoB,CAI9BC,QAAQ,CAAEA,CAJoB,CAK3BC,KAAK,CAAEA,CALoB,CAMhCO,UAAU,GANsB,CAO7BC,OAAO,GAPsB,CAQhCC,UAAU,GARsB,CADhB,CAAD,CAAV,CAjBiC,CA+BhDR,CAAQ,CAAC,CAAD,CAAR,CAAYS,IAAZ,CAAiB,SAASC,CAAT,CAAmB,IAC5BC,CAAAA,CAAkB,CAAGC,QAAQ,CAACC,cAAT,CAAwB,oBAAxB,CADO,CAE5BC,CAAS,CAAGJ,CAAQ,CAACI,SAFO,CAG5BC,CAAU,CAAGC,CAAgB,CAACjB,CAAD,CAAQD,CAAR,CAAkBgB,CAAlB,CAHD,CAI5BG,CAAI,CAAG,2EACPF,CADO,CAEPL,CAAQ,CAACO,IAFF,CAGP,QAP4B,CAUhC,GAAI1B,CAAJ,CAAoB,CAChBA,CAAc,CAAC2B,OAAf,EACH,CACJ,CAbD,CAeH,CAzDgF,CAiE3EF,CAAgB,CAAG,SAACG,CAAD,CAAO/B,CAAP,CAAgB0B,CAAhB,CAA8B,CAInD,GAAIM,CAAAA,CAAS,CAAG,cAAE,qBAAF,CAAhB,CACAC,UAAoBC,eAApB,CAEI,EAFJ,CAII,SAASC,CAAT,CAAoBC,CAApB,CAA6B,CACzB,MAAOD,CAAAA,CAAS,CAACE,GAAV,CAAc,SAASC,CAAT,CAAmB,CAEpCF,CAAO,CAACG,cAAR,CAAuB,CAAvB,EACAC,OAAO,CAACC,GAAR,CAAYH,CAAZ,CAYH,CAfM,CAgBV,CArBL,CAuBI,CACII,sBAAsB,GAD1B,CAEIC,cAAc,CAAE,uBAFpB,CAGIC,kBAAkB,CAAE,iCAHxB,CAvBJ,EA4BEC,IA5BF,CA4BO,SAAShB,CAAT,CAAeiB,CAAf,CAAmB,CAEtBN,OAAO,CAACC,GAAR,CAAYZ,CAAZ,EACAkB,UAAUC,mBAAV,CAA8BhB,CAA9B,CAAyCH,CAAzC,CAA+CiB,CAA/C,CACH,CAhCD,EAkCA,MAAO,oBAAsBpB,CAAtB,CAAkC,SAE5C,CA1GgF,CA4GjFtB,CAAW,EACd,CA7GM,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Question bank filter managemnet.\n *\n * @module     qbank_editquestion/filter\n * @copyright  2021 Tomo Tsuyuki <tomotsuyuki@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as CoreFilter from 'core/filter';\nimport ajax from 'core/ajax';\nimport $ from 'jquery';\nimport Templates from 'core/templates';\nimport PagedContentFactory from 'core/paged_content_factory';\n\n/**\n * Initialise the question bank filter on the element with the given id.\n *\n * @param {String} filterRegionId\n * @param {String} defaultcourseid\n * @param {String} defaultcategoryid\n * @param {int} perpage\n */\nexport const init = (filterRegionId, defaultcourseid, defaultcategoryid, perpage) => {\n    CoreFilter.init(filterRegionId, 'QbankTable', function(filterdata, pendingPromise) {\n        applyFilter(filterdata, pendingPromise);\n    });\n\n    /**\n     * Retrieve table data.\n     *\n     * @param {Object} filter data\n     * @param {Promise} filter pending promise\n     */\n    const applyFilter = (filterdata, pendingPromise) => {\n        if (filterdata) {\n            var courseid = filterdata['courseid'].values.toString();\n            var categories = filterdata['category'] ? filterdata['category'].values.toString() : '';\n            var qtagids = filterdata['tag'] ? filterdata['tag'].values.toString() : '';\n        } else {\n            var courseid = defaultcourseid;\n            var categories = defaultcategoryid;\n            var qtagids = '';\n        }\n\n        let qperpage = perpage;\n        let qpage = 0;\n        let qbshowtext = false;\n        let recurse = false;\n        let showhidden = false;\n\n        let promises = ajax.call([{\n            methodname: 'core_qbank_dummy', args: {\n                    courseid: courseid,\n                    category: categories,\n                     qtagids: qtagids,\n                    qperpage: qperpage,\n                       qpage: qpage,\n                  qbshowtext: qbshowtext,\n                     recurse: recurse,\n                  showhidden: showhidden\n                }\n            }\n        ]);\n\n        promises[0].done(function(response) {\n            let questionscontainer = document.getElementById('questionscontainer');\n            let totalpage = response.totalpage;\n            let pagination = renderPagination(qpage, qperpage, totalpage);\n            let html = '<div className=\"categoryquestionscontainer\" id=\"questionscontainer\">' +\n                pagination +\n                response.html +\n                '</div>';\n            // questionscontainer.innerHTML = html;\n\n            if (pendingPromise) {\n                pendingPromise.resolve();\n            }\n        });\n\n    };\n    /**\n     * Render pagination\n     *\n     * @param {int} page\n     * @param {int} perpage\n     * @param {int} totalpage\n     */\n    const renderPagination = (page, perpage, totalpage) => {\n\n\n        // Some container for your paged content.\n        var container = $('#questionscontainer');\n        PagedContentFactory.createWithLimit(\n            // Show 10 items per page.\n            10,\n            // Callback to load and render the items as the user clicks on the pages.\n            function(pagesData, actions) {\n                return pagesData.map(function(pageData) {\n                    // Your function to load the data for the given limit and offset.\n                    actions.allItemsLoaded(1);\n                    console.log(pageData);\n                    // return loadData(pageData.limit, pageData.offset)\n                        // .then(function(data) {\n                        //     // You criteria for when all of the data has been loaded.\n                        //     if (data.length > 100) {\n                        //         // Tell the page content code everything has been loaded now.\n                        //         actions.allItemsLoaded(pageData.pageNumber);\n                        //     }\n                        //\n                        //     // Your function to render the data you've loaded.\n                        //     // return renderData(data);\n                        // });\n                });\n            },\n            // Config to set up the paged content.\n            {\n                controlPlacementBottom: true,\n                eventNamespace: 'example-paged-content',\n                persistentLimitKey: 'example-paged-content-limit-key'\n            }\n        ).then(function(html, js) {\n            // Add the paged content into the page.\n            console.log(html);\n            Templates.replaceNodeContents(container, html, js);\n        });\n\n        return '<div> Total page:' + totalpage + ' </div>';\n\n    };\n\n    applyFilter();\n};\n\n"],"file":"filter.min.js"}