{"version":3,"sources":["../src/order_categories.js"],"names":["setupSortableLists","SortableList","moveHandlerSelector","on","EVENTS","DROP","evt","stopPropagation","categoryListElements","parent","href","children","queryString","substr","search","params","URLSearchParams","cat","get","oldContextId","oldCat","remove","newOrder","getNewOrder","setCatOrder","JSON","stringify","updatedCategories","response","Ajax","call","methodname","args","categories","fail","Notification","exception","then","resp","console","log","parse","someval","url","window","document","URL","dataType","success","html","oldCtxCat","newCatOrder","destinationCtx","i","length","listItems","querySelectorAll","listOrder","j","contextId","push","filter","ctxId","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for report card display and processing.\n *\n * @package    qbank_managecategories\n * @author     Ghaly Marc-Alexandre <marc-alexandreghaly@catalyst-ca.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n *\n*/\n\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport SortableList from 'core/sortable_list';\nimport Templates from 'core/templates';\nimport $ from 'jquery';\n\n/**\n * Sets up sortable list in the column sort order page.\n *\n * @returns {void}\n */\nconst setupSortableLists = () => {\n    new SortableList(\n        '.category_list',\n        {\n            moveHandlerSelector: '.list_item [data-drag-type=move]',\n        }\n    );\n    $('.list_item').on(SortableList.EVENTS.DROP, (evt) => {\n        evt.stopPropagation();\n        let categoryListElements = $('.list_item').parent();\n        // Get moved list item href URL.\n        let href = $('li.list_item[style]')[0].children[0].children[0].href;\n        // Get query string for that URL.\n        let queryString = href.substr(href.search('\\\\?'));\n        const params = new URLSearchParams(queryString);\n        let cat = params.get('cat');\n        // Get old context and category id.\n        let oldContextId = cat.substr(cat.search(',')+1);\n        let oldCat = cat.substr(0, cat.search(','));\n        // Remove proxy created by sortable list.\n        $('li.list_item[style]').remove();\n        let newOrder = getNewOrder(categoryListElements, oldContextId, oldCat);\n        // Call external function.\n        setCatOrder(JSON.stringify(newOrder));\n        // setTimeout(() => {\n        //     pageReload();\n        // }, 500);\n    });\n};\n\n/**\n * Reloads page.\n *\n * @returns {void}\n */\nconst pageReload = () => {\n    let url = window.location.href;\n    window.location.href = url;\n};\n\nconst templateRender = (context) => {\n    Templates.render('qbank_managecategories/categoryobject', context).done((html) => {\n        $('#categoriesrendered').replaceWith(html);\n    });\n};\n\n/**\n * Call external function set_category_order - inserts the updated column in the question_categories table.\n *\n * @param {string} updatedCategories String containing new sortorder.\n * @returns {void}\n */\n const setCatOrder = (updatedCategories) => {\n    let response = Ajax.call([{\n        methodname: 'qbank_managecategories_set_category_order',\n        args: {categories: updatedCategories},\n        fail: Notification.exception\n    }]);\n    response[0].then((resp) => console.log(JSON.parse(resp)));\n    let context = {\n        listitem: \"somedat\"\n    };\n    let someval = Ajax.call([{\n        url: window.document.URL,\n        dataType: 'html',\n        success: (response) => {\n            $('#categoriesrendered').html(response);\n        },\n    }]);\n    someval[0].then((resp) => console.log(JSON.parse(resp)));\n    //templateRender(context);\n};\n\n/**\n * Retrieving the order on EVENT.DROP, also gets new parameter\n *\n * @param {JQuery<HTMLElement>} categoryListElements List of HTML element to parse.\n * @param {int} oldContextId Old context id to change.\n * @param {int} oldCat Old category.\n * @returns {array}\n */\nconst getNewOrder = (categoryListElements, oldContextId, oldCat) => {\n    let oldCtxCat = oldContextId + ' ' + oldCat;\n    let newCatOrder = [];\n    let destinationCtx = [];\n    for (let i = 0; i < categoryListElements.length; i++) {\n        let listItems = categoryListElements[i].querySelectorAll('li.list_item');\n        let listOrder = [];\n        for (let j = 0; j < listItems.length; j++) {\n            // Get href parameters.\n            let href = listItems[j].children[0].children[0].href;\n            let queryString = href.substr(href.search('\\\\?'));\n            const params = new URLSearchParams(queryString);\n            // Parameters.\n            let cat = params.get('cat');\n            let contextId = cat.substr(cat.search(',') + 1);\n            cat = cat.substr(0, cat.search(','));\n            listOrder[j] = contextId + ' ' + cat;\n            if (listOrder[j] === oldCtxCat){\n                destinationCtx.push(listOrder);\n            }\n        }\n        // New category order.\n        newCatOrder[i] = listOrder;\n    }\n    destinationCtx = destinationCtx[0];\n    destinationCtx = destinationCtx.filter((ctxId) => ctxId !== oldCtxCat);\n    return [newCatOrder, destinationCtx[0], oldCtxCat];\n};\n\nexport const init = () => {\n    setupSortableLists();\n};\n"],"file":"order_categories.min.js"}